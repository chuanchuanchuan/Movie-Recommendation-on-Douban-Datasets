import pymysql

class wordCloud(object):
    def __init__(self):
        pass

    def processMovie(self, seq, conn):
        seq=eval(seq)
        typeFreq=dict()

        sql='''
        select type from movie_original where id=%s
        '''
        with conn.cursor() as cur:
            for movie_id, movie_rate in seq.items():
                n=cur.execute(sql, movie_id)
                if n!=0:
                    get=cur.fetchall()
                    # print(get[0][0])
                    flags=get[0][0].split(',')
                    for flag in flags:
                        typeFreq[flag]=typeFreq.get(flag, 0)+movie_rate
        return typeFreq


if __name__=='__main__':
    g="{'3075287': 5, '3179758': 3, '4739952': 4, '6872273': 4, '5244092': 4, '1418070': 5, '3824672': 5, '24875534': 5, '20443013': 2, '6527269': 4, '5353344': 5, '3412882': 3, '26313973': 4, '26311973': 4, '2299482': 3, '24529353': 3, '1305978': 4, '1292001': 5, '25779218': 5, '24827387': 4, '21352814': 5, '26375609': 2, '26282448': 2, '5319835': 2, '10791575': 3, '5958582': 5, '26315270': 4, '3011235': 5, '26347994': 5, '26394441': 3, '25850122': 2, '5308265': 5, '24879858': 3, '24751764': 4, '19944106': 5, '1291561': 5, '1291560': 5, '24751763': 5, '26613473': 1, '26341750': 4, '26279433': 5, '25805741': 1, '1291586': 4, '24752702': 1, '10463953': 5, '26101081': 5, '1302425': 5, '4942778': 2, '26280528': 1, '1307739': 5, '3179706': 3, '24743711': 5, '1293323': 5, '25845910': 5, '26655581': 5, '25827935': 1, '6386345': 5, '3993588': 4, '1878360': 5, '25835293': 3, '23788440': 4, '4023638': 5, '21360417': 5, '11524967': 3, '24745500': 4, '4709904': 5, '2213597': 5, '25798222': 5, '25908065': 1, '2129039': 5, '10484117': 4, '1294408': 5, '10574622': 4, '25911595': 1, '26354336': 3, '26415255': 1, '1292052': 5, '4237879': 4, '21318488': 4, '6982558': 3, '25823132': 4, '26219652': 3, '1858711': 5, '2124718': 3, '21817627': 5, '26325320': 5, '1929463': 5, '25917973': 5, '25911694': 1, '1866479': 5, '21759697': 5, '1305164': 5, '1292679': 5, '10485647': 5, '25777330': 3, '25843976': 1, '26302614': 3, '25824741': 4, '11589036': 5, '25830800': 1, '1828115': 4, '4212172': 5, '26290365': 2, '26269510': 3, '24827545': 1, '3230459': 5, '1305789': 5, '4919019': 1, '1308162': 4, '25853727': 5, '3718279': 4, '26564988': 2, '25870236': 4, '26298935': 5, '26367579': 4, '1295124': 5, '3734112': 5, '21350556': 4, '26876595': 2, '5377708': 5, '26977230': 3, '21937452': 5, '25823275': 1, '2303163': 4, '1304022': 4, '4078562': 4, '26345736': 1, '3071604': 5, '1291579': 5, '1291574': 5, '1291575': 5, '25789352': 2, '5923466': 5, '26657015': 1, '25662329': 5, '25834473': 4, '25710912': 4, '25662327': 3, '3011091': 5, '25797778': 1, '25777370': 4, '24758396': 1, '25820460': 4, '3541415': 5, '1303037': 4, '26000205': 4, '26263919': 3, '20438962': 4, '25899616': 1, '26430092': 5, '26322928': 5, '1292523': 4, '4920528': 5, '2355581': 4, '26298756': 4, '26322792': 5, '26277313': 5, '25912924': 3, '10726941': 4, '26416169': 4, '21359619': 3, '10440138': 4, '4004731': 4, '2303845': 4, '4067152': 5, '26585014': 4, '6799191': 4, '26862259': 1, '25757186': 3, '26299410': 1, '25757189': 5, '26274328': 3, '1786739': 5, '10733376': 5, '1418834': 5, '20253940': 1, '26289144': 4, '6886518': 4, '6068516': 1, '1864810': 5, '25864085': 4, '3742360': 5, '26663086': 4, '1293839': 5, '25919910': 4, '6080775': 5, '3737102': 4, '25794302': 3, '3792799': 5, '1291546': 5, '1291548': 4, '4275502': 1, '26703457': 5, '10545939': 3, '6873736': 3, '24750534': 2, '25975243': 5, '1308807': 4, '21441132': 5, '25743807': 3, '7065161': 3, '26182910': 5, '26727298': 5, '2131669': 3, '25859593': 3, '6390823': 4, '25786060': 4, '4873490': 4, '3813779': 4, '1292720': 5, '2153389': 5, '25899479': 2, '25728507': 4, '11776289': 4, '25920885': 2, '1306249': 5, '1292329': 4, '3274505': 4, '1292287': 5, '20020577': 4, '4917726': 5, '1889243': 5, '26352440': 2, '24405378': 5, '1849031': 5, '24325815': 2, '25773932': 4, '23761370': 5, '25792670': 3, '26012321': 3, '1966460': 5, '10545971': 5, '25662337': 5, '3804891': 4, '1292213': 5, '1301168': 5, '10047547': 3, '26701276': 5, '25890005': 5, '3530403': 5, '5977835': 3, '1297604': 4, '26654811': 5, '25798448': 5, '25742299': 4, '25742295': 3, '1308575': 5, '4876722': 5, '25895901': 4, '4913200': 5, '4811813': 3, '1428581': 5, '26608228': 3, '20471852': 5, '26354526': 3, '25859495': 5, '26637534': 2, '6011806': 4, '26351867': 1, '26726098': 5, '1485260': 4, '25823833': 3, '21327878': 5, '26652816': 3, '10831449': 4, '3442220': 5, '25944714': 3, '25849006': 1, '25777636': 5, '2334904': 5, '5323968': 5, '24719063': 5, '6730004': 5, '4913222': 1, '4881607': 4, '1293172': 5, '24826968': 2, '24879820': 4, '25819229': 4, '7564989': 5, '26427831': 3, '20326665': 5, '5912992': 4, '21327728': 3, '3793783': 5, '2284418': 5, '1308780': 3, '11808948': 5, '1291550': 5, '1291555': 5, '2131940': 4, '25850443': 5, '25881781': 4, '25881780': 5, '6517608': 5, '26421030': 2, '1862151': 5, '25986180': 5, '26295709': 1, '26607739': 1, '25958839': 1, '1309004': 4, '26389697': 3, '26310143': 5, '26658568': 1, '1307681': 4, '26271094': 2, '4728471': 1, '1316510': 5, '10574468': 5, '4006302': 1, '25831874': 5, '21941770': 2, '26609475': 4, '26284595': 1, '26220725': 3, '24827406': 1, '19973815': 4, '24843198': 4, '25886500': 2, '25837175': 2, '24987018': 3, '10774104': 4, '25830732': 4, '1293088': 5, '25960721': 5, '24696982': 5, '26410592': 4, '1292722': 5, '1306317': 4, '1300064': 5, '25849475': 2, '5327268': 5, '1294007': 5, '1291858': 4, '25872931': 3, '1291851': 5, '25815034': 5, '26811779': 1, '6517421': 4, '26125779': 3, '25964071': 4, '7564975': 1, '24751757': 3, '24751756': 4, '3793023': 5, '10831445': 2, '11026735': 5, '3287562': 5, '26287804': 3, '1302874': 4, '10537853': 5, '1292343': 5, '1864290': 4, '6124012': 1, '26301582': 3, '24847343': 2, '10568385': 5, '1303394': 5}"
    wc=wordCloud()
    conn=pymysql.connect(user='root', password='140014.Cjy', db='douban')
    typeFreq=wc.processMovie(g, conn)
    print(typeFreq)
    


